{% extends "base.html" %}

{% block title %}Playback - Multiroom Audio{% endblock %}

{% block content %}
<h1>Playback</h1>

<div class="section">
    <button class="btn" onclick="loadSnapcastStatus()">
        Refresh Status
    </button>
</div>

<div id="snapcast-status">
    <p class="text-muted">Loading...</p>
</div>

<script>
async function loadSnapcastStatus() {
    const container = document.getElementById('snapcast-status');
    container.innerHTML = '<p>Loading...</p>';

    try {
        const response = await fetch('/api/snapcast/status');
        const data = await response.json();

        if (data.error) {
            container.innerHTML = `<p class="error">Error: ${data.error}</p>`;
            return;
        }

        let html = '';

        // Streams
        html += '<div class="section"><h2>Streams</h2><div class="streams-status">';
        for (const stream of data.streams || []) {
            const statusClass = stream.status === 'playing' ? 'playing' : 'idle';
            html += `
                <div class="stream-status-card ${statusClass}">
                    <div class="stream-name">${stream.id}</div>
                    <div class="stream-state">${stream.status}</div>
                </div>
            `;
        }
        html += '</div></div>';

        // Groups
        html += '<div class="section"><h2>Groups</h2><div class="groups-status">';
        for (const group of data.groups || []) {
            html += `
                <div class="group-card">
                    <div class="group-header">
                        <h3>${group.name || 'Group'}</h3>
                        <span class="badge">${group.stream_id}</span>
                    </div>
                    <div class="group-clients">
            `;
            for (const client of group.clients || []) {
                const connClass = client.connected ? 'connected' : 'disconnected';
                html += `
                    <div class="client-row ${connClass}">
                        <span class="client-name">${client.name || client.id}</span>
                        <span class="client-status">${client.connected ? 'Connected' : 'Disconnected'}</span>
                    </div>
                `;
            }
            html += '</div></div>';
        }
        html += '</div></div>';

        container.innerHTML = html;
    } catch (e) {
        container.innerHTML = `<p class="error">Connection error: ${e.message}</p>`;
    }
}

// Auto-load on page load
loadSnapcastStatus();
</script>
{% endblock %}
